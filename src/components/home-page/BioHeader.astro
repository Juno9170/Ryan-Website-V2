---
import Picture from "astro/components/Picture.astro";
import Image from "astro/components/Image.astro";
import FallbackHeadshot from "../../assets/headshot_ryanzhu.jpg";
import ViewProjectsButton from "./ViewProjectsButton.astro";
import ContactMeButton from "./ContactMeButton.astro";

const fetchData = async () => {
  const response = await fetch("https://graphql.datocms.com/", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Accept: "application/json",
      Authorization: `Bearer ${import.meta.env.DATOCMS_API_KEY}`,
    },
    body: JSON.stringify({
      query: `
        query MyQuery {
          biographySection {
            headshot {
              alt
              avifUrl: url(imgixParams: {q: 80, fm: avif, w: 500, h: 800})
              webpUrl: url(imgixParams: {q: 80, fm: webp, w: 500, h: 800})
              jpgUrl: url(imgixParams:{q:75 , fm:jpg, w:500, h:800})
            }
            biography
          }
        }
      `,
    }),
  });

  const json = await response.json();
  return json.data.biographySection;
};

const data = await fetchData();
const { biography, headshot } = data;
const avifUrl = headshot.avifUrl || "";
const webpUrl = headshot.webpUrl || "";
const jpgUrl = headshot.jpgUrl || "";
const alt = headshot.alt || "headshot image";
---

<div class="xl:h-screen px-10 xl:px-24 flex flex-col xl:flex-row relative">
  <div class="flex-1 pt-32 xl:pt-40 xxl:pt-52 xxxl:pt-80">
    <div
      class="text-3xl xl:text-5xl xxl:text-6xl xxxl:text-8xl text-[#585A4E]"
      style={{ textShadow: "0px 5px 10px #00000040" }}
    >
      Hello, I'm <span class="font-AndersonBolder">Ryan Zhu,</span> a <span
        class="font-AndersonBolder">Computer Science Student</span
      >
    </div>
    <div
      class="text-xl lg:text-2xl xxxl:text-4xl font-AndersonLight pt-10 xl:pr-24 xxl:pr-40 xxl:pt-20"
      style={{ textShadow: "2px 2px #ffffff" }}
    >
      {biography}
    </div>
    <div
      class="flex gap-6 md:gap-16 mb-10 xl:m-0 xxl:gap-32 justify-evenly xl:justify-start pt-5 xl:pr-24 xxl:pr-40 xxl:pt-12"
    >
      <div class="flex w-72 h-16 justify-center items-center">
        <ViewProjectsButton
          className=" h-10 md:h-12 w-36 md:active:h-14 md:w-52 hover:w-60 transition-all duration-300 ease-[var(--ease-spring-2)]"
        />
      </div>
      <div class="flex w-72 h-16 justify-center items-center">
        <ContactMeButton
          className=" h-10 md:h-12 md:active:h-14 w-36 md:w-52 hover:w-60 transition-all duration-300 ease-[var(--ease-spring-2)]"
        />
      </div>
    </div>
  </div>
  <div class="flex-1 flex justify-center items-center">
    <div class="w-2/3 xl:w-auto xl:h-auto flex justify-center items-center">
      <div class="">
        <picture>
          <source srcset={avifUrl} type="image/avif" />
          <source srcset={webpUrl} type="image/webp" />
          <img src={jpgUrl} alt={alt} loading="eager" decoding="async" />
        </picture>
      </div>
    </div>
  </div>
</div>
